<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Forge Integrations - Git Repo Manager</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="repos.html"><strong aria-hidden="true">3.</strong> Repository trees</a></li><li class="chapter-item expanded "><a href="worktrees.html"><strong aria-hidden="true">4.</strong> Git Worktrees</a></li><li class="chapter-item expanded "><a href="forge_integration.html" class="active"><strong aria-hidden="true">5.</strong> Forge Integrations</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">6.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">7.</strong> Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Git Repo Manager</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="forge-integrations"><a class="header" href="#forge-integrations">Forge Integrations</a></h1>
<p>In addition to manging repositories locally, <code>grm</code> also integrates with source
code hosting platforms. Right now, the following platforms are supported:</p>
<ul>
<li><a href="https://github.com/">GitHub</a></li>
<li><a href="https://gitlab.com/">GitLab</a></li>
</ul>
<p>Imagine you are just starting out with <code>grm</code> and want to clone all your repositories
from GitHub. This is as simple as:</p>
<pre><code class="language-bash">$ grm repos sync remote --provider github --owner --token-command &quot;pass show github_grm_access_token&quot; --path ~/projects
</code></pre>
<p>You will end up with your projects cloned into <code>~/projects/{your_github_username}/</code></p>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<p>The only currently supported authentication option is using personal access
token.</p>
<h3 id="github"><a class="header" href="#github">GitHub</a></h3>
<p>See the GitHub documentation for personal access tokens:
<a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Link</a>.</p>
<p>The only required permission is the &quot;repo&quot; scope.</p>
<h3 id="github-1"><a class="header" href="#github-1">GitHub</a></h3>
<p>See the GitLab documentation for personal access tokens:
<a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html">Link</a>.</p>
<p>The required scopes are a bit weird. Actually, the following should suffice:</p>
<ul>
<li>
<ul>
<li><code>read_user</code> to get user information (required to get the current authenticated
user name for the <code>--owner</code> filter.</li>
</ul>
</li>
<li>A scope that allows reading private repositories. (<code>read_repository</code> is just
for <em>cloning</em> private repos). This unfortunately does not exist.</li>
</ul>
<p>So currently, you'll need to select the <code>read_api</code> scope.</p>
<h2 id="filters"><a class="header" href="#filters">Filters</a></h2>
<p>By default, <code>grm</code> will sync <strong>nothing</strong>. This is quite boring, so you have to
tell the command what repositories to include. They are all inclusive (i.e. act
as a logical OR), so you can easily chain many filters to clone a bunch of
repositories. It's quite simple:</p>
<ul>
<li><code>--user &lt;USER&gt;</code> syncs all repositories of that remote user</li>
<li><code>--group &lt;GROUP&gt;</code> syncs all repositories of that remote group/organization</li>
<li><code>--owner</code> syncs all repositories of the user that is used for authentication.
This is effectively a shortcut for <code>--user $YOUR_USER</code></li>
<li><code>--access</code> syncs all repositories that the current user has access to</li>
</ul>
<p>Easiest to see in an example:</p>
<pre><code class="language-bash">$ grm repos sync remote --provider github --user torvals --owner --group zalando [...]
</code></pre>
<p>This would sync all of Torvald's repositories, all of my own repositories and
all (public) repositories in the &quot;zalando&quot; group.</p>
<h2 id="strategies"><a class="header" href="#strategies">Strategies</a></h2>
<p>There are generally three ways how you can use <code>grm</code> with forges:</p>
<h3 id="ad-hoc-cloning"><a class="header" href="#ad-hoc-cloning">Ad-hoc cloning</a></h3>
<p>This is the easiest, there are no local files involved. You just run the
command, <code>grm</code> clones the repos, that's it. If you run the command again, <code>grm</code>
will figure out the differences between local and remote repositories and
resolve them locally.</p>
<h3 id="create-a-file"><a class="header" href="#create-a-file">Create a file</a></h3>
<p>This is effectively <code>grm repos find local</code>, but using the forge instead of the
local file system. You will end up with a normal repository file that you can
commit to git. To update the list of repositories, just run the command again
and commit the new file.</p>
<h3 id="define-options-in-a-file"><a class="header" href="#define-options-in-a-file">Define options in a file</a></h3>
<p>This is a hybrid approach: You define filtering options in a file that you can
commit to source control. Effectively, you are persisting the options you gave
to <code>grm</code> on the command line with the ad-hoc approach. Similarly, <code>grm</code> will
figure out differences between local and remote and resolve them.</p>
<p>A file would look like this:</p>
<pre><code class="language-toml">provider = &quot;github&quot;
token_command = &quot;cat ~/.github_token&quot;
root = &quot;~/projects&quot;

[filters]
owner = true
groups = [
  &quot;zalando&quot;
]
</code></pre>
<p>The options in the file map to the command line options of the <code>grm repos sync remote</code> command.</p>
<p>You'd then run the <code>grm repos sync</code> command the same way as with a list of
repositories in a config:</p>
<pre><code class="language-bash">$ grm repos sync --config example.config.toml
</code></pre>
<p>You can even use that file to generate a repository list that you can feed into
<code>grm repos sync</code>:</p>
<pre><code class="language-bash">$ grm repos find config --config example.config.toml &gt; repos.toml
$ grm repos sync config --config repos.toml
</code></pre>
<h2 id="using-with-selfhosted-gitlab"><a class="header" href="#using-with-selfhosted-gitlab">Using with selfhosted GitLab</a></h2>
<p>By default, <code>grm</code> uses the default GitLab API endpoint
(<a href="https://gitlab.com">https://gitlab.com</a>). You can override the
endpoint by specifying the <code>--api-url</code> parameter. Like this:</p>
<pre><code class="language-bash">$ grm repos sync remote --provider gitlab --api-url https://gitlab.example.com [...]
</code></pre>
<h2 id="the-cloning-protocol"><a class="header" href="#the-cloning-protocol">The cloning protocol</a></h2>
<p>By default, <code>grm</code> will use HTTPS for public repositories and SSH otherwise. This
can be overridden with the <code>--force-ssh</code> switch.</p>
<h2 id="about-the-token-command"><a class="header" href="#about-the-token-command">About the token command</a></h2>
<p>To ensure maximum flexibility, <code>grm</code> has a single way to get the token it uses
to authenticate: Specify a command that returns the token via stdout. This easily
integrates with password managers like <a href="https://www.passwordstore.org/"><code>pass</code></a>.</p>
<p>Of course, you are also free to specify something like <code>echo mytoken</code> as the
command, as long as you are ok with the security implications (like having the
token in cleartext in your shell history). It may be better to have the token
in a file instead and read it: <code>cat ~/.gitlab_token</code>.</p>
<p>Generally, use whatever you want. The command just has to return sucessfully and
return the token as the first line of stdout.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>Maybe you just want to locally clone all repos from your github user?</p>
<pre><code class="language-bash">$ grm repos sync remote --provider github --owner --root ~/github_projects --token-command &quot;pass show github_grm_access_token&quot;
</code></pre>
<p>This will clone all repositories into <code>~/github_projects/{your_github_username}</code>.</p>
<p>If instead you want to clone <strong>all</strong> repositories you have access to (e.g. via
organizations or other users' private repos you have access to), just change the
filter a little bit:</p>
<pre><code class="language-bash">$ grm repos sync remote --provider github --access --root ~/github_projects --token-command &quot;pass show github_grm_access_token&quot;
</code></pre>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<h3 id="github-2"><a class="header" href="#github-2">GitHub</a></h3>
<p>Unfortunately, GitHub does not have a nice API endpoint to get <strong>private</strong>
repositories for a certain user (<a href="https://docs.github.com/en/rest/repos/repos#list-repositories-for-a-user"><code>/users/{user}/repos/</code></a> only returns public
repositories).</p>
<p>Therefore, using <code>--user {user}</code> will only show public repositories for GitHub.
Note that this does not apply to <code>--access</code>: If you have access to another user's
private repository, it will be listed.</p>
<h2 id="adding-integrations"><a class="header" href="#adding-integrations">Adding integrations</a></h2>
<p>Adding a new integration involves writing some Rust code. Most of the logic is
generic, so you will not have to reinvent the wheel. Generally, you will need to
gather the following information:</p>
<ul>
<li>A list of repositories for a single user</li>
<li>A list of repositories for a group (or any similar concept if applicable)</li>
<li>A list of repositories for the user that the API token belongs to</li>
<li>The username of the currently authenticated user</li>
</ul>
<p>Authentication currently only works via a bearer token passed via the
<code>Authorization</code> HTTP header.</p>
<p>Each repo has to have the following properties:</p>
<ul>
<li>A name (which also acts as the identifier for diff between local and remote
repositories)</li>
<li>An SSH url to push to</li>
<li>An HTTPS url to clone and fetch from</li>
<li>A flag that marks the repository as private</li>
</ul>
<p>If you plan to implement another forge, please first open an issue so we can
go through the required setup. I'm happy to help!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="worktrees.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="faq.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="worktrees.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="faq.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
